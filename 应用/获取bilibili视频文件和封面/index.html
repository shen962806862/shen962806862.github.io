<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="author" content="Szh">
    
    
    
    
    
    
    <title>获取bilibili视频文件和封面 | 小涵の米奇妙妙屋</title>
    <!-- inject:style -->
    <link href="/css/style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/css/prism.css">
    <!-- <link href="/css/monokai_sublime.min.css" rel="stylesheet"> -->
    <!-- endinject -->
    <style>
        .cube-loading {
            top: 0;
            position: fixed;
            width: 100%;
            height: 100%;
            background: url('/images/lg/loading.gif') no-repeat center center;
            background-color: rgba(0,0,0,.7);
        }

        .cube-loading.out {
            display: none;
        }

        .cube-loading:before {
            display: block;
            content: 'Loading';
            position: relative;
            width: 100%;
            top: 50%;
            right: -50%;
            color: #fff;
        }

        @media(max-width: 768px) {
            .cube-loading:before {
                font-size: 1.2em;
                transform: translate(-24px,20px);
                -webkit-transform: translate(-24px,20px);
                -o-transform: translate(-24px,20px);
                -ms-transform: translate(-24px,20px);
            }
        }

        @media(min-width: 768px) {
            .cube-loading:before {

            }
        }
    </style>
    
    <script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?a8ed5b37dd0aaae924c52eb382109c5d";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    
<meta name="generator" content="Hexo 5.4.0"></head>
<body>
<div class="cube-body">
    <nav id="cube-top-memu" class="cube-menu">
    <ul class="cube-menu-collapse">
        
        <li>
            <i class="cube-icon cube-icon-home" aria-hidden="true"></i>
            <a href="/">首页</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-archive" aria-hidden="true"></i>
            <a href="/archives">归档</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-categories" aria-hidden="true"></i>
            <a href="/categories">分类</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-tags" aria-hidden="true"></i>
            <a href="/tags">标签</a>
        </li>
        
        <li>
            <i class="cube-icon cube-icon-about" aria-hidden="true"></i>
            <a href="/about">关于我</a>
        </li>
        
    </ul>
</nav>
<nav class="cube-side-menu" id="cube-side-menu">
    <ul class="cube-menu-list">
        
        <li>
            <a class="scroll-to-top">Top</a>
        </li>
    </ul>
</nav>
    <header class="cube-header" id="cube-header">
    <img src=" https://myweb-1259751480.cos.ap-shanghai.myqcloud.com/images/background.jpg " alt="头部背景图片">
    
    <div class="cube-type">
        <span class="cube-typed-title">小涵の米奇妙妙屋</span>
        <span class="cube-typed-cursor">|</span>
    </div>
    
</header>

    <style>
        nav.cube-menu:before {
            content: '';
            visibility: hidden;
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 44px;
        
            filter: blur(5px);
            -webkit-filter: blur(5px);
        
            z-index: -1;
            background-image: url('https://myweb-1259751480.cos.ap-shanghai.myqcloud.com/images/background.jpg');
            background-repeat: no-repeat;
            background-position: center 44px;
            background-size: cover;
            background-color: transparent;
        }

        header.cube-background.cube-header-background {
            visibility: hidden;
            background-image: url('https://myweb-1259751480.cos.ap-shanghai.myqcloud.com/images/background.jpg');
            background-position: center 0;
        }
    </style>
    <header class="cube-background cube-header-background">
        
        <div class="cube-type">
            <span class="cube-typed-title">小涵の米奇妙妙屋</span>
            <span class="cube-typed-cursor">|</span>
        </div>
        
    </header>
    <div class="load-header-background"></div>
    <script>
        (function (window) {

            window.headerModule = {}
            window.headerModule.image = {
                width: '680',
                height: '280'
            }

        })(window)
    </script>
    
    <div class="cube-content">
        <div class="cube-left">
            

<div class="cube-search cube-sidebar" id="cube-search">
    <div class="search-container">
        <input type="text" placeholder="Search" class="cube-search-input" id="cube-search-input">
        <i class="cube-icon cube-icon-search cube-search-submit" aria-hidden="true"></i>
    </div>
    <!-- TODO 通过给window赋一个全局变量，通过脚本赋值 -->
</div>
<script>
    (function (window) {
        'use strict';
        window.searchModule = {}
        window.searchModule.JSONUrl = '/content.json'
        window.searchModule.rootUrl = '/'
    })(window)
</script>
<div class="cube-search-form">
    <div class="cube-search-control">
        <input type="text" placeholder="Search" class="search-input">
        <a class="close-button">
            <i class="cube-icon cube-close" aria-hidden="true"></i>
        </a>
    </div>
    <div class="cube-search-result"></div>
</div>


<div class="cube-author cube-sidebar" id="cube-author">
    
    
    <span>Szh</span>
    
    
    <div class="count">
        <a class="count articles"><span>12</span>Article</a>
        <a class="count tags"><span>13</span>Tags</a>
        <a class="count categories"><span>3</span>Categories</a>
    </div>
</div>



<div class="cube-recent-posts cube-sidebar" id="cube-recent-posts">
    <div class="title">
        <a>Recent Posts</a>
    </div>
    <ul class="list">
        
        
        <li>
            <!-- TODO 如果文章要显示图片，那么在front-matter上添加preview属性(url or path) -->
            
            <div class="normal">
                <p class="index first">
                    <span>1</span>
                </p>
                <p class="title">
                    <a href="/%E5%8E%9F%E7%90%86/%E5%9F%BA%E4%BA%8ESTM32F103%E7%9A%84%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" title="基于STM32F103的实时操作系统">基于STM32F103的实时操作系统</a>
                </p>
            </div>
            
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>2</span>
                </p>
                <p class="title">
                    <a href="/%E5%8E%9F%E7%90%86/opencv%E5%9B%BE%E5%83%8F%E7%AE%97%E6%B3%95/" title="opencv图像算法">opencv图像算法</a>
                </p>
            </div>
        </li>
        
        
        
        <li>
            <div class="normal">
                <p class="index">
                    <span>3</span>
                </p>
                <p class="title">
                    <a href="/%E6%9D%82%E8%AE%B0/opencv%E7%A7%BB%E5%BA%93%E7%AC%94%E8%AE%B0/" title="opencv移库笔记">opencv移库笔记</a>
                </p>
            </div>
        </li>
        
        
    </ul>
</div>



<div class="cube-categories cube-sidebar" id="cube-categories">
    <div class="title">
        <a href="/categories">Categories</a>
    </div>
    <div class="cube-boxs">
        
        
        <div class="cube-box-bg ">
            <a href="/categories/%E5%BA%94%E7%94%A8/">#应用</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E5%8E%9F%E7%90%86/">#原理</a>
        </div>
        
        
        <div class="cube-box ">
            <a href="/categories/%E6%9D%82%E8%AE%B0/">#杂记</a>
        </div>
        
    </div>
</div>



<div class="cube-tagcloud cube-sidebar" id="cube-tagcloud">
    <div class="title">
        <a href="/tags">Tagcloud</a>
    </div>
    <div class="cube-boxs">
        
        
        
        
        
        
        
         
            <div class="cube-box ">
                <a href="/tags/%E8%84%9A%E6%9C%AC/">#脚本</a>
            </div>
        
        
         
            <div class="cube-box ">
                <a href="/tags/%E5%8A%A0%E5%AF%86%E4%B8%8E%E7%BC%96%E7%A0%81/">#加密与编码</a>
            </div>
        
        
        
        
        
        
         
            <div class="cube-box-bg ">
                <a href="/tags/%E5%89%8D%E7%AB%AF/">#前端</a>
            </div>
        
        
        
        
         
            <div class="cube-box ">
                <a href="/tags/%E7%A1%AC%E4%BB%B6/">#硬件</a>
            </div>
        
        
         
            <div class="cube-box ">
                <a href="/tags/python%E7%88%AC%E8%99%AB/">#python爬虫</a>
            </div>
        
        
         
            <div class="cube-box ">
                <a href="/tags/%E7%8E%AF%E5%A2%83/">#环境</a>
            </div>
        
        
         
            <div class="cube-box ">
                <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/">#嵌入式</a>
            </div>
        
        
         
            <div class="cube-box ">
                <a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/">#操作系统</a>
            </div>
        
    </div>
</div>



<div class="cube-links cube-sidebar" id="cube-links">
    <div class="title">
        <a>Links</a>
    </div>
    <ul class="list">
        
        <li>
            
            
            <img src="https://myweb-1259751480.cos.ap-shanghai.myqcloud.com/images/icons/github.png">
            
            <a href="https://github.com/shen962806862" target="_blank">GitHub</a>
        </li>
        
        <li>
            
            
            <img src="https://myweb-1259751480.cos.ap-shanghai.myqcloud.com/images/icons/csdn.jpg">
            
            <a href="https://blog.csdn.net/shen962806862" target="_blank">CSDN</a>
        </li>
        
    </ul>
</div>



<div class="cube-toc cube-sidebar" id="cube-toc">
    <div class="title">
        <a>Toc</a>
    </div>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B0%81%E9%9D%A2"><span class="toc-text">获取封面</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%88%AC%E5%8F%96%E5%9B%BE%E7%89%87%E7%9A%84%E8%84%9A%E6%9C%AC"><span class="toc-text">1.爬取图片的脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-py%E8%84%9A%E6%9C%AC%E4%B8%8Ephp%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92"><span class="toc-text">2.py脚本与php的数据交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%89%8D%E5%90%8E%E7%AB%AF%E6%95%B0%E6%8D%AE%E4%BA%A4%E4%BA%92"><span class="toc-text">3.前后端数据交互</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6"><span class="toc-text">获取视频文件</span></a></li></ol>
</div>


        </div>
        <div class="cube-right">
            <div class="cube-article">
<h1 class="title">获取bilibili视频文件和封面</h1>

    <div class="cube-article-header">
        <div class="cube-article-date">
            <i class="cube-icon cube-icon-date" aria-hidden="true"></i>
            <!-- moment.js对象 -->
            2020-04-30
        </div>
        <div class="cube-article-updated">
            <i class="cube-icon cube-icon-updated" aria-hidden="true"></i>
            2022-04-06
        </div>
        <div class="cube-article-tags">
    <i class="cube-icon cube-icon-tag" aria-hidden="true"></i>
    
    <a href="/tags/%E8%84%9A%E6%9C%AC/">#脚本</a>
    
    <a href="/tags/%E5%89%8D%E7%AB%AF/">#前端</a>
    
    <a href="/tags/python%E7%88%AC%E8%99%AB/">#python爬虫</a>
    
</div>
    </div>

    <div class="cube-article-content cube-markdown">
        
        <p>前两天在阿草微博粉丝群水群的时候，看到有朋友说<del>馋</del>想要一个往期视频的封面，但不知道咋保存~（网上有封面提取的网站）</p>
<p>我一想，应该可以用爬虫去实现嘛，挺有意思的，就尝试着写了一下，链接如下👇</p>
<p><a href="http://www.hanhan0223.cn/TextProject/BilibiliGetting/bilibili.php">获取b站视频封面</a></p>
<p>（现在挂在我的云服务器上，但等到过期了就寄了，GitHub Page并不支持php。话说当初学php就是因为在云服务器上建站用的WordPress，想改别人的主题但是看不懂代码才去学的）</p>
<p>三项功能：</p>
<ol>
<li><p>输入视频的网址、BV号获取AV号（AV号明面上已经被b站禁了，但后台实际还在）；</p>
</li>
<li><p>输入视频的网址、BV号、AV号获取视频封面；</p>
</li>
<li><p>输入up主的UID获取该up主所有视频的封面，并打包成zip文件下载。</p>
</li>
</ol>
<span id="more"></span>

<h1 id="获取封面"><a href="#获取封面" class="headerlink" title="获取封面"></a>获取封面</h1><h2 id="1-爬取图片的脚本"><a href="#1-爬取图片的脚本" class="headerlink" title="1.爬取图片的脚本"></a>1.爬取图片的脚本</h2><p><strong>如何找到b站视频的相关信息和封面图片的源网址呢？</strong></p>
<h3 id="关于封面图"><a href="#关于封面图" class="headerlink" title="关于封面图"></a>关于封面图</h3><p>最开始学爬虫的朋友们应该都爬过豆瓣top250这个经典案例。</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/html0-1024x394.png" alt="img"></p>
<p>在body里找到img属性，里面的src就是图片的原链接了。但是要注意到一点，这里图片源文件的后缀：webp。这是一种有损压缩格式图片，优势在于网络传输快，但爬取视频封面是为了什么！是为了高清图啊！所以不能这么爬。</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/html0.5-1024x388.png" alt="img"></p>
<p>在个人主页中，可以通过选取工具定位到img标签，发现src里的也是webp格式图片</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/src1-1024x470.png" alt="img"></p>
<p>打开链接图片很糊而且像素低。那么问题来了，哪里有高清的呢！答案就在视频界面里。</p>
<p><img src="http://www.hanhan0223.cn/wp-content/uploads/2020/04/html2-1024x415.png" alt="img"></p>
<p>不在body中！因为视频界面并没有显示封面图片！而是在head中！找到属性（itemprop）为image的，发现content中的链接，后缀为jpg格式，这就找对了，打开发现确实是高清图</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/src2-1024x479.png" alt="img"></p>
<p>链接位置找到了，剩下的就简单了~就不多说了。</p>
<h3 id="关于AV号"><a href="#关于AV号" class="headerlink" title="关于AV号"></a>关于AV号</h3><p>之前b站因为av号名称违规（？）改为了BV号，但是av号并没有完全删除，在b站中搜索视频av号同样能获取视频，这说明av号这项数据依旧保存着，那如何找出该数据呢？在b站的数据接口。</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/link1-1024x378.png" alt="img"></p>
<p>打开解析器network选项，可以看到该视频数据接口的url。archive（档案）后面的内容aid同理可以替换成bvid</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/data1.png" alt="img"></p>
<p>可以看到该网址返回的是一串json数据，里面包含了av、bv、投币、收藏、点赞、分享、评论、观看数、这些数据，在这里便可以获取到AV号了，在就脚本中解析该json数据然后提取就可以显示在网页中了。</p>
<p>而个人空间同样拥有数据接口保存了该页所有视频的标题、简介、bv等信息，也可以获取下来，不再赘述。</p>
<h2 id="2-py脚本与php的数据交互"><a href="#2-py脚本与php的数据交互" class="headerlink" title="2.py脚本与php的数据交互"></a>2.py脚本与php的数据交互</h2><p><strong>py文件如何向php文件传值？ ajax如何获取php文件的传值？php中如何调用py脚本？</strong></p>
<p>传值其实很简单，，就是打印函数，python 的<strong>print</strong>和php 的<strong>echo</strong>。</p>
<p>调用py脚本，用exec函数：</p>
<pre><code class="line-numbers language-php">$c = exec(&quot;/usr/bin/python GetBilibiliUpCover.py &#123;$func&#125; &#123;$uid&#125; &#123;$bv&#125;&quot;);
</code></pre>
<p>exec用于执行一个外部程序，主体为执行命令，可以附带参数传递，输出数组和状态返回。因为程序要在服务器里运行，所以输入的就是ubuntu的命令行了，ubuntu怎么运行python脚本就怎么来。</p>
<p>后面的三个是输入参数。在python中通过如下方式获取：</p>
<pre><code class="line-numbers language-python">sys.argv[1]
</code></pre>
<p>argv是一个数组，第一位是模块的名称，这里不去管他，从1开始是按序输入的参数，这里输入了三个，就分别用1、2、3来获取就行。</p>
<h2 id="3-前后端数据交互"><a href="#3-前后端数据交互" class="headerlink" title="3.前后端数据交互"></a>3.前后端数据交互</h2><p>本半吊子表示根本没系统学过前端知识，所以做这一部分的时候异常痛苦，，界面也丑的一言难尽==</p>
<p>用的ajax，但一开始死都进不去succes步，总进error。。</p>
<pre><code class="line-numbers language-javascript">$.ajax(&#123;
    type : &quot;GET&quot;,
    url : &quot;getting.php&quot;,
    data : &#123;
        &#39;func&#39;:$(&quot;#f1&quot;).val(),
        &#39;bv&#39;:$(&quot;#av_info&quot;).val()
    &#125;,
    dataType : &quot;text&quot;,
    success : function(msg) &#123;
        $(&quot;#result&quot;).empty();
        document.getElementById(&quot;dynamic_av&quot;).style.display = &quot;&quot;;
        var data = &#39;&#39;;
        if (msg != &#39;&#39;)&#123;
            data = eval(&quot;(&quot;+msg+&quot;)&quot;);
        &#125;
        $(&quot;#result_av&quot;).html(&quot;AV号: &quot; + data.av);
    &#125;,
    error: function (msg, textStatus) &#123;
        console.log(msg);
    &#125;
&#125;);
</code></pre>
<p>后来发现一开始数据类型用的json，网上说必须要非常标准的json数据才能接收到，我也不明白为什么我在py文件里封装的json数据就不行。。。</p>
<p>后来就改成text，文本用eval转化一下提取出来就解决了。</p>
<h1 id="获取视频文件"><a href="#获取视频文件" class="headerlink" title="获取视频文件"></a>获取视频文件</h1><p>首先进F12，看一下：</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/image-20220110093329162.png" alt="image-20220110093329162"></p>
<p>可以看到视频源文件这边并不是mp4的源文件，而是开头带了<strong>blob：</strong>的链接，是无法访问的（暂时不了解这方面的技术，所以找了个取巧的办法）</p>
<p>点击开发者工具的左上角，切换为手机模拟状态，可以看到：</p>
<p><img src="/%E5%BA%94%E7%94%A8/%E8%8E%B7%E5%8F%96bilibili%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E5%92%8C%E5%B0%81%E9%9D%A2/image-20220110093926135.png" alt="image-20220110093926135"></p>
<p>手机端的src不再是blob了，而是变成了这样一个url，打开即可下载mp4源文件了~舒服！</p>

    </div>
</div>

<div class="cube-article-nav">
    <ul>
        
        <li class="prev">
        <a href="/%E5%8E%9F%E7%90%86/%E5%85%B3%E4%BA%8ERSA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/">
            <i class="cube-icon cube-prev" aria-hidden="true"></i>
            关于RSA加密算法
        </a>
        </li>
        
            
            <li class="next">
            <a href="/%E6%9D%82%E8%AE%B0/%E7%AC%AC%E4%B8%80%E6%AC%A1%E7%AC%94%E8%AE%B0%E6%9C%AC%E6%8B%86%E6%9C%BA%E4%BD%93%E9%AA%8C/">
                第一次笔记本拆机体验
                <i class="cube-icon cube-next" aria-hidden="true"></i>
            </a>
        </li>
        
    </ul>
</div>


<!-- TODO 根据theme.comment的内容进行入口选择 -->


        </div>
    </div>
</div>
<footer class="cube-footer">
    
    © 2017 Szh

    <br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>.&nbsp;Theme by <a href="https://github.com/ZEROKISEKI" target="_blank">AONOSORA</a>
    <br>
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次 &nbsp; </span>
<span id="busuanzi_container_site_uv">访客数<span id="busuanzi_value_site_uv"></span>人次</span>

<script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?a8ed5b37dd0aaae924c52eb382109c5d";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
</script>

<script src="/js/prism.js" async></script>




</footer>
<!-- inject:script -->
<script src="/js/script.js"></script>
<!-- endinject -->
<div class="cube-loading out"></div>
</body>
</html>